<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Stpr Types &#8212; Stpr</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/basic_mod.css?v=9b2032db" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=b283b5c5" />
    <link rel="stylesheet" type="text/css" href="../_static/fixes.css?v=40ebb8c7" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200..900&family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Radio+Canada:ital,wght@0,300..700;1,300..700&display=swap" rel="stylesheet">

    
    <script src="../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/main.js?v=6c1a4791"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/petite-vue.js"></script>

    <link rel="canonical" href="/stpr/api/types.html" />
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Stpr Functions" href="functions.html" />
    <link rel="prev" title="Concurrency Primitives" href="primitives.html" /> 
  </head><body class="page-api/types docpage" data-dark_mode_code_blocks="true">
    <div id="top_nav">
        

        <nav>
            
                
            

            <h1><a href="/stpr" title="Go to homepage">Stpr</a></h1>


            <ul class="top-menu">
    <li><a href="/stpr/install.html" class="not-active">Install</a></li>
    <li><a href="/stpr/docs/index.html" class="active">Documentation</a></li>
</ul>
                <p class="mobile_search_link">
                    <a href="../search.html" title="Search">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                            <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                        </svg>
                    </a>
                </p>
            
                <div class="searchbox_wrapper">
                    
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
                </div>
            

            <a href="https://github.com/hategan/stpr" class="gh">GitHub</a>
        </nav>
    </div>

        
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="primitives.html">Concurrency Primitives</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stpr Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Stpr Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="reactives.html">Reactive Variables and Functions</a></li>
</ul>

  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="primitives.html"
                          title="previous chapter">Concurrency Primitives</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="functions.html"
                          title="next chapter">Stpr Functions</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/types.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="stpr-types">
<h1>Stpr Types<a class="headerlink" href="#stpr-types" title="Link to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="stpr.channels.Channel">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Channel</span></span><a class="reference internal" href="../_modules/stpr/channels.html#Channel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stpr.channels.Channel" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.AsyncIterator" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncIterator</span></code></a>[<a class="reference internal" href="#stpr.types.T" title="stpr.types.T"><code class="xref py py-obj docutils literal notranslate"><span class="pre">T</span></code></a>]</p>
<p>This class implements a channel.</p>
<p>A channel is an ordered collection that can be iterated over asynchronously. Values consumed
from a channel are removed completely and cannot be iterated over again. The typical
scenario is that values are added to a channel in a thread and consumed in another:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nd">@stpr</span><span class="o">.</span><span class="n">fn</span>
<span class="k">def</span> <span class="nf">consumer</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">Channel</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="p">[</span><span class="k">async</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Received </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Channel closed&#39;</span><span class="p">)</span>

<span class="nd">@stpr</span><span class="o">.</span><span class="n">fn</span>
<span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">Channel</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">+=</span> <span class="n">n</span>
        <span class="n">stpr</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nd">@stpr</span><span class="o">.</span><span class="n">fn</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Channel</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">stpr</span><span class="o">.</span><span class="n">parallel</span><span class="p">:</span>
        <span class="n">consumer</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">producer</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Where <cite>[async]</cite> is enclosed in square brackets because it is optional. Iteration over a channel
will continue as a long as the <cite>close()</cite> or <cite>fail()</cite> methods on the channel are not called.
While <cite>close()</cite> and <cite>fail()</cite> can be invoked explicitly, it generally safer to use the channel
as a context manager, which automatically takes care of closing and/or failing the channel:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nd">@stpr</span><span class="o">.</span><span class="n">fn</span>
<span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">Channel</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">stpr</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, the channel is closed automatically when the <cite>with</cite> statement completes.
Any exceptions thrown by <cite>f()</cite> will propagate out of <cite>producer()</cite>, but also be raised in the
consumer function after all other values in the channel are consumed.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stpr.channels.Channel.append">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">append</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#stpr.types.T" title="stpr.types.T"><span class="pre">T</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/stpr/channels.html#Channel.append"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stpr.channels.Channel.append" title="Link to this definition">¶</a></dt>
<dd><p>Appends a value to this channel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>value</strong> (<a class="reference internal" href="#stpr.types.T" title="stpr.types.T"><em>T</em></a>) – The value to append.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>None</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stpr.channels.Channel.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/stpr/channels.html#Channel.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stpr.channels.Channel.close" title="Link to this definition">¶</a></dt>
<dd><p>Closes this channel.</p>
<p>When the channel is closed and all previously added items are consumed, the channel will
raise <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#StopAsyncIteration" title="(in Python v3.13)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">StopAsyncIteration</span></code></a> gracefully terminating the iteration
that is used to consume values from this channel.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>None</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stpr.channels.Channel.fail">
<span class="sig-name descname"><span class="pre">fail</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exception</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.13)"><span class="pre">Exception</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/stpr/channels.html#Channel.fail"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stpr.channels.Channel.fail" title="Link to this definition">¶</a></dt>
<dd><p>Fails (poisons) this channel.</p>
<p>When this method is called, a special values is added to the channel. When attempts are
made to consume that value, <code class="docutils literal notranslate"><span class="pre">exception</span></code> is raised instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>exception</strong> (<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.13)"><em>Exception</em></a>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>None</em></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stpr.channels.select">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">select</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#stpr.channels.Channel" title="stpr.channels.Channel"><span class="pre">Channel</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stpr.types.T" title="stpr.types.T"><span class="pre">T</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stpr.channels.Channel" title="stpr.channels.Channel"><span class="pre">Channel</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stpr.types.T" title="stpr.types.T"><span class="pre">T</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#stpr.channels.Channel" title="stpr.channels.Channel"><span class="pre">Channel</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stpr.types.T" title="stpr.types.T"><span class="pre">T</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/stpr/channels.html#select"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stpr.channels.select" title="Link to this definition">¶</a></dt>
<dd><p>Implements a channel selector.</p>
<p>A channel selector is a construct that will wait until a value is added to any one of the
selected channels. For each such value in each channel, the returned channel will produce
a tuple <code class="docutils literal notranslate"><span class="pre">(value,</span> <span class="pre">channel)</span></code> with the value added and the channel it was added to. For
example:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nd">@stpr</span><span class="o">.</span><span class="n">fn</span>
<span class="k">def</span> <span class="nf">select_example</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">Channel</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">Channel</span><span class="p">()</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">stpr</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">stpr</span><span class="o">.</span><span class="n">parallel</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> received on </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">stpr</span><span class="o">.</span><span class="n">seq</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">b</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">stpr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">select_example</span><span class="p">)</span>
</pre></div>
</div>
<p>This example will produce an output similar to the following:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span>received<span class="w"> </span>on<span class="w"> </span>&lt;stpr.channels.Channel<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x77985d383620&gt;
<span class="m">2</span><span class="w"> </span>received<span class="w"> </span>on<span class="w"> </span>&lt;stpr.channels.Channel<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x77985bf6ef90&gt;
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>args</strong> (<a class="reference internal" href="#stpr.channels.Channel" title="stpr.channels.Channel"><em>Channel</em></a><em>[</em><a class="reference internal" href="#stpr.types.T" title="stpr.types.T"><em>T</em></a><em>]</em>) – One or more channels to select from.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A channel with <code class="docutils literal notranslate"><span class="pre">(value,</span> <span class="pre">channel)</span></code> tuples corresponding to values added to the
selected channels.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#stpr.channels.Channel" title="stpr.channels.Channel"><em>Channel</em></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><em>Tuple</em></a>[<a class="reference internal" href="#stpr.types.T" title="stpr.types.T"><em>T</em></a>, <a class="reference internal" href="#stpr.channels.Channel" title="stpr.channels.Channel"><em>Channel</em></a>[<a class="reference internal" href="#stpr.types.T" title="stpr.types.T"><em>T</em></a>]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stpr.types.T">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">T</span></span><a class="headerlink" href="#stpr.types.T" title="Link to this definition">¶</a></dt>
<dd><p>A generic type alias.</p>
<p>alias of TypeVar(‘T’)</p>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
        <div id="right_sidebar">
            <h4>Page contents</h4>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">Stpr Types</a><ul>
<li><a class="reference internal" href="#stpr.channels.Channel"><code class="docutils literal notranslate"><span class="pre">Channel</span></code></a><ul>
<li><a class="reference internal" href="#stpr.channels.Channel.append"><code class="docutils literal notranslate"><span class="pre">Channel.append()</span></code></a></li>
<li><a class="reference internal" href="#stpr.channels.Channel.close"><code class="docutils literal notranslate"><span class="pre">Channel.close()</span></code></a></li>
<li><a class="reference internal" href="#stpr.channels.Channel.fail"><code class="docutils literal notranslate"><span class="pre">Channel.fail()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#stpr.channels.select"><code class="docutils literal notranslate"><span class="pre">select()</span></code></a></li>
<li><a class="reference internal" href="#stpr.types.T"><code class="docutils literal notranslate"><span class="pre">T</span></code></a></li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="primitives.html">
                    <span class="icon">&lt;</span><span>Concurrency Primitives</span></a>
                
            </div>

            <div class="right">
                
                    <a href="functions.html"><span>Stpr Functions</span><span class="icon">&gt;</span></a>
                
            </div>
        </div>
    </div>

        

  </body>
</html>